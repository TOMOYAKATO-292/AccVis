# 空間統計モデルの詳細解説

## 1. カーネル密度推定(KDE: Kernel Density Estimation)

### 基本概念

カーネル密度推定は、点データ(事故発生地点)から連続的な密度分布を推定する手法です。各事故地点を中心に「影響範囲」を持つ分布を重ね合わせることで、滑らかな密度マップを作成します。

### 仕組み

**ステップ 1: カーネル関数の配置**
各事故地点(xi, yi)を中心に、カーネル関数 K(距離に応じて重みが減衰する関数)を配置します。

**ステップ 2: 重ね合わせ**
すべての地点のカーネル関数を足し合わせます。事故が集中している場所では複数のカーネルが重なり、密度が高くなります。

**数式**

```
f(x,y) = (1/nh²) Σ K(√((x-xi)²+(y-yi)²) / h)
```

- f(x,y): 地点(x,y)での密度推定値
- n: 事故件数
- h: バンド幅(影響範囲の広さ)
- K: カーネル関数(ガウシアン、エパネチニコフなど)

### 重要なパラメータ

**バンド幅(h)**

- 小さい値: 詳細だが不安定な密度マップ
- 大きい値: 滑らかだが詳細が失われる
- 適切な値の選定が重要(クロスバリデーションなどで決定)

**カーネル関数の種類**

- ガウシアン: 最も一般的、滑らかな分布
- エパネチニコフ: 計算効率が良い
- 四次関数: ガウシアンとエパネチニコフの中間

### 出力と解釈

**ヒートマップ**

- 色の濃い場所: 事故リスクが高い
- 色の薄い場所: 事故リスクが低い

**活用方法**

- 視覚的に危険エリアを特定
- 重点的な安全対策エリアの選定
- リスクレベルに応じた段階的な対策の計画

### 利点と限界

**利点**

- 直感的でわかりやすい
- 特別な仮定が不要
- 非線形な空間パターンに対応可能

**限界**

- バンド幅の選択に依存
- 境界効果(地図の端で密度が低く推定される)
- 事故の要因は説明できない(密度のみ)

---

## 2. 空間自己相関分析

### 基本概念

「近くのものは似ている」という地理学の第一法則を定量化する手法です。事故が空間的にランダムに分布しているのか、特定の地域に集中(クラスター化)しているのかを統計的に検証します。

### Moran's I 統計量

**グローバル空間自己相関**

全体的な空間パターンを 1 つの指標で表します。

**数式**

```
I = (n/S₀) × Σᵢ Σⱼ wᵢⱼ(xᵢ - x̄)(xⱼ - x̄) / Σᵢ(xᵢ - x̄)²
```

- n: 地域数
- wᵢⱼ: 空間重み行列(地域 i と j が隣接なら 1、そうでなければ 0)
- xᵢ: 地域 i の事故件数
- x̄: 平均事故件数
- S₀: 空間重みの合計

**値の解釈**

- I > 0: 正の空間自己相関(似た値が集まる)
  - 事故多発地域が隣接して存在
- I ≈ 0: 空間的にランダム
- I < 0: 負の空間自己相関(異なる値が隣接)
  - 事故多発地域と少発地域が交互に存在

**統計的検定**
帰無仮説「空間的にランダムに分布している」を検定し、p 値が小さければクラスター化していると判断できます。

### Getis-Ord Gi\* 統計量

**ローカル空間自己相関**

Moran's I が全体的なパターンを見るのに対し、Gi\*は各地域ごとに「周辺と比べて高いか低いか」を評価します。

**数式**

```
Gi*(d) = Σⱼ wᵢⱼ(d)xⱼ / Σⱼ xⱼ
```

- wᵢⱼ(d): 距離 d の範囲内にある地域 j に対する重み
- 標準化した Gi\*値(Z-score)を算出

**値の解釈**

- Gi\* > 0 (統計的に有意): ホットスポット
  - その地域とその周辺で事故が多い
- Gi\* < 0 (統計的に有意): コールドスポット
  - その地域とその周辺で事故が少ない
- 有意でない: 特徴的なパターンなし

**出力例**
地図上に色分けして表示:

- 赤色(濃い): 高い値のホットスポット(事故多発クラスター)
- ピンク: やや高い値のホットスポット
- 青色(濃い): コールドスポット(事故少発クラスター)
- 白色: 統計的に有意でない

### 空間重み行列の設定

分析結果に大きく影響する重要な要素です。

**隣接性ベース**

- Rook(ルーク): 辺を共有する地域を隣接とみなす
- Queen(クイーン): 辺または頂点を共有する地域を隣接とみなす

**距離ベース**

- 一定距離内の地域を隣接とみなす
- 距離の逆数で重み付け(近いほど重みが大きい)

**k 最近隣**

- 各地域について最も近い k 個の地域を隣接とみなす

### 実務での活用

**分析の流れ**

1. Moran's I で全体的なクラスター化を確認

   - p < 0.05 で有意なら、空間的なパターンが存在

2. Gi\*統計量でホットスポットを特定

   - どこが特に危険な地域かを地図上で可視化

3. ホットスポットの特徴を分析

   - なぜその地域で事故が集中するのか
   - 道路構造、交通量、地域特性などを調査

4. 対策の優先順位付け
   - 統計的に有意なホットスポットから対策

### 利点と限界

**利点**

- 統計的な根拠を持って危険地域を特定
- 「たまたま」ではなく「本当にリスクが高い」地域を識別
- 視覚的にわかりやすい
- 政策決定者への説得力がある

**限界**

- 空間重み行列の設定に依存
- なぜクラスター化しているかの説明は別途必要
- サンプルサイズが小さいと不安定
- 時間的変化は考慮しない(別途時系列分析が必要)

---

## 2 つの手法の使い分け

**KDE が適している場合**

- 視覚的なリスクマップを作成したい
- 連続的なリスク分布を把握したい
- 地域区分が明確でない場合

**空間自己相関分析が適している場合**

- 統計的な根拠が必要
- 行政区画単位で分析したい
- クラスター化の有無を客観的に判断したい

**併用のメリット**
KDE で視覚的に把握し、空間自己相 correlation 分析で統計的に検証するという組み合わせが最も効果的です。
